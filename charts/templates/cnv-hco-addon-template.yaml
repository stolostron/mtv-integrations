apiVersion: addon.open-cluster-management.io/v1alpha1
kind: AddOnTemplate
metadata:
  name: kubevirt-hyperconverged
spec:
  addonName: kubevirt-hyperconverged
  agentSpec:
    workload:
      manifests:
        - apiVersion: hco.kubevirt.io/v1beta1
          kind: HyperConverged
          metadata:
            name: kubevirt-hyperconverged
            annotations:
              deployOVS: 'false'
            namespace: openshift-cnv
          spec:
            virtualMachineOptions:
              disableFreePageReporting: false
              disableSerialConsoleLog: true
            higherWorkloadDensity:
              memoryOvercommitPercentage: 100
            liveMigrationConfig:
              allowAutoConverge: false
              allowPostCopy: false
              completionTimeoutPerGiB: 800
              parallelMigrationsPerCluster: 5
              parallelOutboundMigrationsPerNode: 2
              progressTimeout: 150
              "{{ `{{LIVE_NETWORK_KEY}}` }}":  "{{ `{{LIVE_NETWORK_VALUE}}` }}"
            certConfig:
              ca:
                duration: 48h0m0s
                renewBefore: 24h0m0s
              server:
                duration: 24h0m0s
                renewBefore: 12h0m0s
            applicationAwareConfig:
              allowApplicationAwareClusterResourceQuota: false
              vmiCalcConfigName: DedicatedVirtualResources
            featureGates:
              decentralizedLiveMigration: true
              deployTektonTaskResources: false
              enableCommonBootImageImport: true
              withHostPassthroughCPU: false
              downwardMetrics: false
              disableMDevConfiguration: false
              enableApplicationAwareQuota: false
              deployKubeSecondaryDNS: false
              nonRoot: true
              alignCPUs: false
              enableManagedTenantQuota: false
              primaryUserDefinedNetworkBinding: false
              deployVmConsoleProxy: false
              persistentReservation: false
              autoResourceLimits: false
              deployKubevirtIpamController: false
            workloadUpdateStrategy:
              batchEvictionInterval: 1m0s
              batchEvictionSize: 10
              workloadUpdateMethods:
                - LiveMigrate
            uninstallStrategy: BlockUninstallIfWorkloadsExist
            resourceRequirements:
              vmiCPUAllocationRatio: 10
